syntax = "proto3";

package kvi;
option go_package = "github.com/thirawat27/kvi/pkg/grpc;kvi_grpc";

message GetRequest {
    string key = 1;
}

message GetResponse {
    string id = 1;
    string data_json = 2; // JSON representation for dynamic map
}

message PutRequest {
    string key = 1;
    string data_json = 2;
}

message PutResponse {
    bool success = 1;
}

message VectorSearchRequest {
    repeated float vector = 1;
    int32 k = 2;
}

message VectorSearchResponse {
    message Result {
        string id = 1;
        string data_json = 2;
    }
    repeated Result results = 1;
}

message StreamRequest {
    string id = 1;         // client id
    string channel = 2;    // subscribe channel
    string publish_payload = 3; // if sending a message
}

message StreamResponse {
    string channel = 1;
    string payload = 2;
}

service KviService {
    rpc Get(GetRequest) returns (GetResponse);
    rpc Put(PutRequest) returns (PutResponse);
    rpc VectorSearch(VectorSearchRequest) returns (VectorSearchResponse);
    // Bidirectional Streaming for Pub/Sub & Mesh Comm
    rpc Stream(stream StreamRequest) returns (stream StreamResponse);
}

